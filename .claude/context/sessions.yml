# Session Workflow - Compact Reference
# For examples and workflow details, see: session-workflow.md

MANDATORY-REREAD: before-whats-next-queries (use-3-step-process)

## Session = Long-term Memory
purpose: persist state across conversation resets (context window cleanup)
mapping: 1 session = 1 issue = 1 branch = 1 branch-metadata-file

## Auto-Detection
on-startup: git branch → .claude/branches/<sanitized> → load session file
user-asks: "What's next?" or "What are we working on?"
manual: "Read .claude/sessions/<file>.md"

## CRITICAL: Determining "What's Next"
ALWAYS run these commands in order:
1. .claude/tools/get-session.js (get branch, verify session mapping)
2. Read the session file from the output (find "Next Steps" section)
NEVER guess or assume current branch - ALWAYS check first

## Session Files
location: .claude/sessions/
format: <IssueNum>-<desc>.md OR <type>-<desc>.md
content: goal, log, decisions, learnings, files-changed, next-steps
creation: .claude/tools/create-session.js
update: collaborative (Claude edits directly, user reviews)
commit: atomic (session+code in same commit)

## Branch Metadata
location: .claude/branches/
format: <branch-name-sanitized> (/ → -)
content: session:<file>, status:<state>, next:<step>
size: compact lookup file

## Workflow

### Starting New Work
start: create branch → .claude/tools/create-session.js → creates metadata + session
work: implement → update session after each major task
pause: update session file directly
resume: switch branch → get-session.js → auto-loads correct session
complete: mark session complete, merge PR

## Update Triggers
when: beginning-work, after-milestone, before-pause, when-blocked, before-commit
how: Claude edits session file directly (Edit tool), user reviews changes

## Key Patterns
fresh-conversation-not-equal-lost-context: session file persists state
reset-context-window: start new conversation, read session, quality restored
branch-switch-equal-session-switch: automatic via metadata
commit-regularly: session updates are code documentation

## Tools
get: .claude/tools/get-session.js (--json, --path, --content)
create: .claude/tools/create-session.js (--force to overwrite)
update: direct edit (Claude + user collaboration)

## Benefits
resumable: pick up exactly where left off
traceable: maps to github issues, jira tickets, azure devops work items
handoff: teammates read session, understand work
memory: external state outside context window
